<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Matricula UTP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>

    <nav class="sidebar">
        <div class="sidebar-header">
            <i class="fa-solid fa-graduation-cap fa-lg me-3"></i>
            <span>UTP</span>
        </div>
        <ul class="sidebar-menu">
            <li><a onclick="navigate('matricularse')" id="link-matricularse" class="active"><i class="fa-solid fa-cart-plus"></i><span>Matricularse</span></a></li>
            <li><a onclick="navigate('mis-cursos')" id="link-mis-cursos"><i class="fa-solid fa-book-open"></i><span>Mis Cursos</span></a></li>
            <li><a onclick="navigate('horario')" id="link-horario"><i class="fa-regular fa-calendar-days"></i><span>Horario</span></a></li>
            <li style="margin-top: 50px;"><a href="index.html" class="text-danger"><i class="fa-solid fa-power-off"></i><span>Cerrar Sesi贸n</span></a></li>
        </ul>
    </nav>

    <main class="main-content">
        
        <section id="view-matricularse" class="section-view active">
            <h2 class="mb-4 fw-bold"> Matr铆cula 2025-I</h2>
            <div class="row">
                <div class="col-md-8"><div id="lista-cursos-disponibles"><div class="text-center py-5"><i class="fa fa-spinner fa-spin"></i> Cargando cursos...</div></div></div>
                <div class="col-md-4">
                    <div class="card-custom sticky-top" style="top: 20px;">
                        <h4 class="border-bottom border-black pb-2">Resumen</h4>
                        <div class="d-flex justify-content-between mb-2"><span>Cr茅ditos:</span><span class="fw-bold fs-4" id="contador-creditos">0</span></div>
                        <div class="d-flex justify-content-between mb-3"><span>Horas:</span><span class="fw-bold fs-4" id="contador-horas">0</span></div>
                        <button onclick="confirmarMatricula()" class="btn btn-success w-100 rounded-0 fw-bold">CONFIRMAR MATRCULA</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-mis-cursos" class="section-view">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold"> Mis Cursos Matriculados</h2>
                <button onclick="descargarTablaPDF()" class="btn btn-outline-dark rounded-0"><i class="fa-solid fa-file-pdf"></i> Descargar PDF</button>
            </div>
            <div class="card-custom" id="area-impresion-tabla">
                <table class="table table-hover border-black">
                    <thead class="table-dark"><tr><th>C贸digo</th><th>Curso</th><th>Secci贸n</th><th>Docente</th><th>Horario</th><th>Cr茅ditos</th></tr></thead>
                    <tbody id="tabla-mis-cursos"></tbody>
                </table>
            </div>
        </section>

        <section id="view-horario" class="section-view">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold"> Horario Semanal</h2>
                <div class="btn-group">
                    <button onclick="descargarHorarioImg()" class="btn btn-outline-dark rounded-0"><i class="fa-solid fa-image"></i> PNG</button>
                    <button onclick="descargarHorarioPDF()" class="btn btn-black"><i class="fa-solid fa-file-pdf"></i> PDF</button>
                </div>
            </div>
            <div class="card-custom p-1" id="area-impresion-horario">
                <div class="timetable" id="timetable-grid"></div>
            </div>
        </section>
    </main>

    <!-- Modal Elegir Secci贸n -->
    <div class="modal fade" id="modalSeccion" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content rounded-0 border-2 border-black">
                <div class="modal-header bg-black text-white rounded-0">
                    <h5 class="modal-title">Elegir Secci贸n</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <table class="table table-striped mb-0">
                        <thead>
                            <tr>
                                <th>Sec</th>
                                <th>Docente</th>
                                <th>D铆a</th>
                                <th>Hora</th>
                                <th>Mod</th> 
                                <th>Vac</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="modal-lista-horarios"></tbody>
                    </table>
                </div>
                <!-- BOTN NUEVO -->
                <div class="modal-footer bg-light">
                    <span class="small text-muted me-auto">驴No encuentras horario?</span>
                    <button onclick="abrirConfirmarSolicitud()" class="btn btn-outline-danger btn-sm">
                        <i class="fa-regular fa-hand-paper"></i> Solicitar Apertura de Aula
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Confirmar Solicitud -->
    <div class="modal fade" id="modalConfirmarSolicitud" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content rounded-0 border-2 border-black">
                <div class="modal-header bg-danger text-white rounded-0">
                    <h5 class="modal-title">Confirmar Solicitud</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center p-4">
                    <i class="fa-solid fa-bullhorn fa-3x text-danger mb-3"></i>
                    <p class="fs-5">驴Deseas solicitar la apertura de un nuevo horario para este curso?</p>
                    <p class="text-muted small">Tu solicitud ser谩 enviada a la administraci贸n acad茅mica para su evaluaci贸n.</p>
                    <div class="mt-3">
                        <button type="button" class="btn btn-secondary rounded-0" data-bs-dismiss="modal">Cancelar</button>
                        <button onclick="enviarSolicitud()" class="btn btn-danger rounded-0 px-4">S铆, Solicitar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast" class="toast align-items-center text-white bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body" id="toast-message"></div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/panel.js"></script>
</body>
</html>